/*
 ============================================================================
 Name        : TP1.c
 Author      : Benjamin Van Ryseghem
 Version     :
 Copyright   : MIT
 Description : Hello World in C, Ansi-style
 ============================================================================
 */

#define  DEBUG

#ifdef DEBUG
	#define debug(...) do{ fprintf( stderr, __VA_ARGS__ ); } while( 0 )
#else
	#define debug(...) do{ } while ( 0 )
#endif

#include <stdio.h>
#include <stdlib.h>

int canPrettyPrint = 1;
int currentIndent = 0;
char indent[4] = "    ";

void insertTab(){
	int i;
	for (i = 0; i < currentIndent; i++){
		printf("%s", indent);
	}
}



char internRule(char c){

	if ( c == '#' ){
		char tmp;
		tmp = getchar ();
		while ( ((tmp = getchar()) != EOF) & (tmp != '\n')){ printf("%c",c);}
		printf("\n");
	}
	if ( c == '\n' ){
		char tmp;
		tmp = getchar ();
		while ( ( tmp != EOF) & ((tmp == ' ') | (tmp == '\n') | (tmp == '	'))){ tmp = getchar();}
		printf("\n");
		insertTab();
		return tmp;
	}

	if ( c == '{' ){
		insertTab();
		printf("{\n");
		currentIndent++;
		return 0;
	}

	if ( c == '}' ){


		currentIndent--;
		printf("\n");
		insertTab();
		printf("}\n");
		return 0;
	}

	printf("%c",c);

	return 0;
}


void prettyPrint(){

	char currentChar;
	char previousChar;
	char result;
	currentChar = getchar();
	previousChar = currentChar;

	debug("currentChar = %c\n",currentChar);

	while ( currentChar == ' ' ){
		currentChar = getchar();
	}


	debug("currentChar2 = %c\n",currentChar);

	while ( currentChar != EOF ){

		if (( currentChar == '\"' ) & ( previousChar != '\\') ){
			canPrettyPrint = ! canPrettyPrint;
		}

		if (( currentChar == '*' ) & ( previousChar == '\\') ){
				canPrettyPrint = 0;
				printf("\n");
		}

		if ( (currentChar == '\\') & (previousChar == '*' )){
			canPrettyPrint = 1;
			printf("\n");
		}

		if( canPrettyPrint ){
			result = internRule( currentChar );
		}
		else{
			printf("%c",currentChar);
			result = 0;
		}
		previousChar = currentChar;
		if ( result == 0 ){
			currentChar = getchar();
		}
		else{
			currentChar = result;
		}
	}
}

int main(void) {
prettyPrint();
	return 0;
}
